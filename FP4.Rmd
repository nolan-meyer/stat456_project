---
title: "FP4"
author: "Nolan & Anton"
date: "11/8/2022"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(ggrepel)
library(readxl)
```



# Introduction & RQ's

As college students, we are well aware of the phenomenon of rising tuition costs. In recent years, the cost of attending college has skyrocketed, leaving many to wonder how they will afford to finance their education. Many students have to take out federal loans to help cover the up-front costs.

```{r}
tuition_cost <- read_excel("FP3/college_cost_over_time.xls", sheet = "Sheet1")
head(tuition_cost)

tuition_cost %>% 
  ggplot(aes(x = Year, y = Amount, color = Length)) +
  geom_line() +
  facet_wrap(~Type) +
  theme_classic() +
  labs(title = "Average undergraduate cost of fees, room, and board rates in current USD", x = "", y = "")
```

This leads us to wonder: how are federal loans distributed, and who has to take out the most loans for college? Which majors tend to borrow the most, and do they provide a good return on investment? Our research questions are stated below: 

1.

  - Focusing on federal aid & loans, are there any **gender and race biases in how much aid is given** (or based on EFC)?

  - At what point does your **family income** (and/or EFC) **result in  zero federal aid/loans**?
  
2.

  - What majors provide the **best ROI** of expected family contributions (EFC) in terms of salary post grad?
  
  - What majors provide the **biggest increase in financial well-being** (based on family income or EFC)?




# Data

Our data files come from the National Center for Education Statistics, which can be found here: [NCES DataLab](https://nces.ed.gov/datalab/). The two studies we have used separately so far in our work are the "Baccalaureate & Beyond (08-18)" study and the "National Post-secondary Student Aid Study, Undergraduate (2016)". In general, both studies compile various data on undergraduate students like major, financial aid, student loan amount, and much more. The B&B study also include data *beyond* the undergraduate level and tracks data like future salary.

We manually pulled and cleaned data sets relating to particular variables of interest, which are loaded in below. These files can be found and downloaded from our [GitHub repository](https://github.com/nolan-meyer/stat456_project).

```{r}
data <- read_csv("11_8_data.csv")
explorerace <- read_csv("10_efc_borrow_race.csv")
exploregender <- read_csv("10_efc_borrow_gender.csv")
```




# Work, Plots, and Analyses

## Amount Borrowed for College in 2016 by race and gender

```{r}
Cum_amt_borrowed_2016 <- read_excel("FP3/amt_borrowed.xlsx", sheet = "Sheet1")
head(Cum_amt_borrowed_2016)

Cum_amt_borrowed_2016 %>% 
  ggplot(aes(x = fct_reorder(Race, Amount, .desc = T), y = Amount, fill = Gender)) +
  geom_bar(stat="identity", position = position_dodge()) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 50, vjust = 1, hjust=1, size = 8.5, color = "black")) +
  scale_fill_brewer(palette = "Paired") +
  labs(x = "", y = "", fill = "", title = "Average amount borrowed for undergrad in 2016 (USD) by race and gender")
```




## Differences in Amount Borrowed vs EFC by major and gender

```{r}
male <- exploregender %>%
  select(field,efc_m,borr_m) %>%
  mutate(gender = "m")
  colnames(male) <- c("field","efc","borr","gender")
female <- exploregender %>%
  select(field,efc_f,borr_f) %>%
  mutate(gender = "f")
  colnames(female) <- c("field","efc","borr","gender")
final <- rbind(male,female)
final$efc <- extract_numeric(final$efc)
```


```{r, eval=F}
longgender <- exploregender %>%
  pivot_longer(cols=c(`efc_f`,`borr_f`,`efc_m`,`borr_m`),names_to="dollars",values_to="total")
```

```{r}
ggplot(final,aes(x=efc,y=borr,color=gender, group=field)) +
  geom_point() +
  geom_text_repel(aes(label=field),
                  size=2.25,
                  box.padding = 0.5,
                  segment.size = 0.25,
                  color = "black")+
geom_line(color="purple")
```

> We exclude education from our analysis because it violates our assumption - the more you are able to pay, the less you borrow.

> If a segment is inelastic (<1), it means the following:
1. The gender that borrows less borrows a lot less even though it is able to pay a little bit more.  
2. The gender that borrows less has less financial burden during college but has to pay more during studies (they finance less of their education)
> If a segment is elastic (>1), it means the following:
1. The gender that borrows less borrows a little less even thouh it is able to pay a lot more
2. The gender that borrows less has more financial burden leaving college but has to pay less during studies (they finance more of their education).


```{r}
wider <- final %>%
    pivot_wider(names_from=gender,values_from=c(efc,borr),values_fill=0,names_sort=TRUE)
```

```{r}
wider <- wider %>%
  mutate(change_efc = (pmax(efc_f,efc_m)-pmin(efc_f,efc_m))/pmin(efc_f,efc_m),change_borr = (pmax(borr_f,borr_m)-pmin(borr_f,borr_m))/pmin(borr_f,borr_m))%>%
    mutate(elasticity = change_efc/change_borr)%>%
  mutate(borr_more = case_when(borr_m>borr_f ~ 'm',
  borr_m<borr_f ~ 'f'))
```

```{r}
wider1 <- wider %>%
  mutate(mid_efc=(efc_f+efc_m)/2,mid_borr=(borr_f+borr_m)/2) %>% mutate(elasticity=((efc_f-efc_m)/(mid_efc))/((borr_f-borr_m)/(mid_borr)))%>%
  mutate(borr_more = case_when(borr_m>borr_f ~ 'm',
  borr_m<borr_f ~ 'f'))%>%
  arrange(elasticity)
```

```{r}
tab<-wider1%>%
  select(field,elasticity,borr_more)
```



## Future Salary

### Salary in 2012 based on field of study in 2008, with confidence intervals

```{r}
data <- readxl::read_xlsx("11_8_data.xlsx", sheet = "salary")
conf_int <- readxl::read_xlsx("11_8_data.xlsx", sheet = "confidence_intervals")

data %>% 
  ggplot() +
  geom_bar(aes(x = fct_reorder(`Field of study: undergraduate (23 categories)`, `Primary job: Annualized salary, 2012`, .desc = T), y = `Primary job: Annualized salary, 2012`), stat = "identity", fill = "skyblue", alpha = 0.7) +
  geom_errorbar(aes(x = `Field of study: undergraduate (23 categories)`, ymin=`CI_low`, ymax=`CI_high`), width=0.4, colour="orange", alpha=0.9, size=1) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 52, vjust = 1, hjust=1, size = 5.5, color = "black")) +
  labs(x = "Field of Study, 2008", y = "Salary, 2012")
```

### Salary in 2018 based on field of study in 2008

```{r}
salary_by_major_2018 <- read_excel("FP3/salary_by_major_0818.xlsx")
head(salary_by_major_2018)

salary_by_major_2018 %>% 
  filter(`Field of study: undergraduate (10 categories)` != "Undeclared") %>% 
  ggplot(aes(x = fct_reorder(`Field of study: undergraduate (10 categories)`, `Current job, as of B&B:08/18 interview: Annualized salary`, .desc = T), y = `Current job, as of B&B:08/18 interview: Annualized salary`)) +
  geom_bar(stat="identity", fill = "#69b3a2") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust=1, size = 7, color = "black")) +
  labs(x = "Undergraduate Field of Study, 2008", y = "Current Job Salary in 2018", title = "")
```



# Rest of Semester Plan





# Contributions

Anton:

Nolan:


