---
title: "FP4"
author: "Nolan & Anton"
date: "11/8/2022"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(ggrepel)
```


# Deliverables

- 6-8 min presentation
- Analysis of research questions & findings
- Project plan for rest of semester


# Research Questions

1.

  - Focusing on federal aid & loans, are there any gender and race biases in how much aid is given based on EFC?

  - At what point does your family income (and/or EFC) result in zero federal aid?
  
2.

  - What majors provide the best ROI of expected family contributions in terms of salary post grad?
  
  - What majors provide the biggest increase in financial well-being based on family income or EFC?




# Data

```{r}
data <- read_csv("11_8_data.csv")
head(data)
```

```{r}
data <- readxl::read_xlsx("11_8_data.xlsx", sheet = "salary")
conf_int <- readxl::read_xlsx("11_8_data.xlsx", sheet = "confidence_intervals")

data %>% 
  ggplot() +
  geom_bar(aes(x = fct_reorder(`Field of study: undergraduate (23 categories)`, `Primary job: Annualized salary, 2012`, .desc = T), y = `Primary job: Annualized salary, 2012`), stat = "identity", fill = "skyblue", alpha = 0.7) +
  geom_errorbar(aes(x = `Field of study: undergraduate (23 categories)`, ymin=`CI_low`, ymax=`CI_high`), width=0.4, colour="orange", alpha=0.9, size=1) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 52, vjust = 1, hjust=1, size = 5.5, color = "black")) +
  labs(x = "Field of Study, 2008", y = "Salary, 2012")
```



#--------------


```{r}
#data <- read_csv("11_8_data.csv")
explorerace <- read_csv("10_efc_borrow_race.csv")
exploregender <- read_csv("10_efc_borrow_gender.csv")
```

```{r}
male <- exploregender %>%
  select(field,efc_m,borr_m) %>%
  mutate(gender = "m")
  colnames(male) <- c("field","efc","borr","gender")
female <- exploregender %>%
  select(field,efc_f,borr_f) %>%
  mutate(gender = "f")
  colnames(female) <- c("field","efc","borr","gender")
final <- rbind(male,female)
final$efc <- extract_numeric(final$efc)
```


```{r, eval=F}
longgender <- exploregender %>%
  pivot_longer(cols=c(`efc_f`,`borr_f`,`efc_m`,`borr_m`),names_to="dollars",values_to="total")
```

```{r}
ggplot(final,aes(x=efc,y=borr,color=gender, group=field)) +
  geom_point() +
  geom_text_repel(aes(label=field),
                  size=2.25,
                  box.padding = 0.5,
                  segment.size = 0.25,
                  color = "black")+
geom_line(color="purple")

```
> We exclude education from our analysis because it violates our assumption - the more you are able to pay, the less you borrow.

> If a segment is inelastic (<1), it means the following:
1. The gender that borrows less borrows a lot less even though it is able to pay a little bit more.  
2. The gender that borrows less has less financial burden during college but has to pay more during studies (they finance less of their education)
> If a segment is elastic (>1), it means the following:
1. The gender that borrows less borrows a little less even thouh it is able to pay a lot more
2. The gender that borrows less has more financial burden leaving college but has to pay less during studies (they finance more of their education).


```{r}
wider <- final %>%
    pivot_wider(names_from=gender,values_from=c(efc,borr),values_fill=0,names_sort=TRUE)
```

```{r}
wider <- wider %>%
  mutate(change_efc = (pmax(efc_f,efc_m)-pmin(efc_f,efc_m))/pmin(efc_f,efc_m),change_borr = (pmax(borr_f,borr_m)-pmin(borr_f,borr_m))/pmin(borr_f,borr_m))%>%
    mutate(elasticity = change_efc/change_borr)%>%
  mutate(borr_more = case_when(borr_m>borr_f ~ 'm',
  borr_m<borr_f ~ 'f'))
```

```{r}
wider1 <- wider %>%
  mutate(mid_efc=(efc_f+efc_m)/2,mid_borr=(borr_f+borr_m)/2) %>% mutate(elasticity=((efc_f-efc_m)/(mid_efc))/((borr_f-borr_m)/(mid_borr)))%>%
  mutate(borr_more = case_when(borr_m>borr_f ~ 'm',
  borr_m<borr_f ~ 'f'))%>%
  arrange(elasticity)
```

```{r}
tab<-wider1%>%
  select(field,elasticity,borr_more)
```


