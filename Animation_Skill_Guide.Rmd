---
title: "Data Science Tutorial: Intro to Animations in R"
author: "Nolan & Anton"
date: "9/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

Animations can be very powerful tools when used effectively, allowing you to see progression over time, iterate through plots, and help you tell a better story with the data. This guide will give an overview of packages, techniques, and tips for creating animated plots in R. 

In this guide you will learn:

- Necessary packages for creating animated plots
- How to turn static plots into animations
- Components of gganimate and what each function does
- Ways to edit, improve, and save your animations



# Getting Started

## Packages

To create animations, there are some R packages you will need to install & load first. The main packages we will be using are:

1. gganimate
2. ggplot2
3. tidyverse
4. gapminder

You will likely need to install the following packages if you haven't worked with animations before:

```{r, eval=F}
install.packages("gganimate")
install.packages("gapminder")
```

Then load the necessary packages:

```{r}
library(gganimate)
library(ggplot2)
library(tidyverse)
library(gapminder)
```


## Data

To create animated plots we must first have some tidy data to work with. We'll start with an unique data set to get familiar with some of the basic features and then later explore some example data.

Head over to (Google Search Trends)[https://trends.google.com/trends/?geo=US] and search up a term that interests you. You should get a graph of the popularity of the search term over time. Click "add comparison" at the top and add at least two more terms (so you have 3 or more total).

One you have a graph of multiple terms, download this as a .csv file to your computer.

**Note:** Once you have your .csv downloaded, click on it in the bottom right "Files" pane and click "View File". The .csv file will open in another tab. Delete the first two rows so that "Week" and the terms you searched are now at the top. Click "Save", and now your .csv is ready for importing.

```{r}
popularity <- read_csv("/Users/nolan/MACALESTER/Stat 456/multiTimeline.csv")
head(popularity)
```

We want this data in tidy format, so lets **pivot_longer** our data.

```{r}
popularity <- popularity %>% 
  pivot_longer(cols = `World cup`:`UEFA Champions League`,
               names_to = "Search Term",
               values_to = "Popularity")
```

Now make a line plot the popularity over time:

```{r}
popularity %>% 
  ggplot(aes(x = Week, y = Popularity, group = `Search Term`, color = `Search Term`)) +
  geom_line() +
  labs(x = "Time", y = "Popularity") +
  theme_classic() +
  theme(legend.position = "top")
```

Now we're ready for animations.



# Creating Animations

Within gganimate, the main concept is the use of **transition functions**, along with some other components that can be altered to create an animation. The main topics we will cover are:

- Transition functions
- Views
- Shadows
- Easing
- Enter and Exit
- Rendering

We will walk through each of these in detail and build upon them to create some cool visualizations.



## Transition functions

### Basics

Transitions control how the data gets displayed in your animation. Do you want your data to populate over time by year, by category, or another filter? This is determined by the transition function you select. The list of transition functions is shown below, along with their functionality.

| Name        | Functionality |
|:-----------|:-----------|
| transition_components | Transition individual components through their own lifecycle |
| transition_events | Transition individual events in and out |
| transition_filter | Transition between different filters |
| transition_layers | Build up a plot, layer by layer |
| transition_manual | Create an animation by specifying the frame membership directly |
| transition_reveal| Reveal data along a given dimension | 
| transition_states | Transition between several distinct stages of the data |
| transition_time | Transition through distinct states in time |


Transition functions are simply added to your regular ggplot statements following a "+". 


### Transition_reveal()

Lets try using transition_reveal() first. The transition will reveal the data along a given dimension -- in this case time. This can be a good option when you have line charts or time-series data. Add **transition_reveal()** to your plot, with the Week variable as the first argument.

```{r, eval=F}
popularity %>% 
  ggplot(aes(x = Week, y = Popularity, group = `Search Term`, color = `Search Term`)) +
  geom_line() +
  labs(x = "Time", y = "Popularity") +
  theme_classic() +
  theme(legend.position = "top") +
  transition_reveal(Week)
```

You should now see your plot animated in the viewer in the bottom right panel of your screen!


### Labels

Another thing we should make sure to add to our animation is how the animation is transitioning. While we know the animation is changing by week, our viewer may not realize or understand that. With some transition functions this may or may not be easily  inferable, so it's good practice to include this information on the plot. We can add this information in the **labs()** part of our ggplot statement, specifying one of the corresponding transition variables related to the transition function we are using (see below).

|Name |	Label variable(s) |
|:---------|:---------|
| transition_components |	frame_time |
| transition_events	| frame_time |
| transition_filter	| previous_filter, closest_filter, next_filter |
| transition_layer	| previous_layer, closest_layer, next_layer, nlayers |
| transition_manual	| previous_frame, current_frame, next_frame |
| transition_reveal	| frame_along |
| transition_states	| previous_state, closest_state, next_state |
| transition_time	| frame_time |

In this case, lets add **title = "Week: {frame_along}"** to our label.

```{r, eval=F}
popularity %>% 
  ggplot(aes(x = Week, y = Popularity, group = `Search Term`, color = `Search Term`)) +
  geom_line() +
  labs(x = "Time", y = "Popularity", title = "Week: {frame_along}") +
  theme_classic() +
  theme(legend.position = "top") +
  transition_reveal(Week)
```


### Transition_states()

```{r}
popularity %>% 
  filter(Week > "2022-08-01",
         `Search Term` == "Premier League") %>% 
  ggplot(aes(x = Week, y = Popularity, fill = Popularity)) +
  geom_col() +
  scale_fill_distiller(palette = "Greens", direction = 1) +
  theme_classic()
```

```{r}
popularity %>% 
  filter(Week > "2022-08-01",
         `Search Term` == "Premier League") %>% 
  ggplot(aes(x = Week, y = Popularity, fill = Popularity)) +
  geom_col() +
  scale_fill_distiller(palette = "Greens", direction = 1) +
  theme_classic() +
  labs(title = "Week: {closest_state}") +
  transition_states(Week, wrap = F)
```


### Transition_time()

A great example data set for animations is gapminder, which contains data on worldwide economic, health, and other public information. Load the data set and preview it below:

```{r}
head(gapminder)
```

Create a plot using some of the 6 variables in the data set. Here's an example:

```{r}
gapminder %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = country, size = pop)) +
  geom_point(alpha = 0.75, show.legend = FALSE) +
  scale_color_viridis_d() +
  labs(x = "GDP per capita", y = "Life expectancy") +
  theme_classic()
```

***Transition_time()**

```{r, eval=F}
gapminder %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp)) +
  geom_point() +
  labs(x = "GDP per capita", y = "Life expectancy", title = "Year: {frame_time}") +
  theme_classic() +
  transition_time(year)
```


